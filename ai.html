<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>Gemini Chat – Pocket Pal Style</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <style>
    :root{
      --bg:#ffffff;
      --surface:#fafafa;
      --divider:#e0e0e0;
      --accent:#FFD600;          /* Pocket Pal yellow */
      --text:#111111;
      --muted:#666666;
      --radius:16px;
      --font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;
    }

    *{box-sizing:border-box;font-family:var(--font)}
    body{margin:0;padding:0;background:var(--bg);color:var(--text);display:flex;flex-direction:column;height:100vh}

    header{background:var(--surface);padding:1rem 1.25rem;font-weight:600;font-size:1.1rem;border-bottom:1px solid var(--divider)}
    .chat-area{flex:1;display:flex;flex-direction:column;overflow:hidden}
    .bubble{margin:.5rem 1rem;padding:.75rem 1rem;border-radius:18px;max-width:75%;line-height:1.4;font-size:.95rem}
    .user{align-self:flex-end;background:var(--accent);color:#000}
    .bot{align-self:flex-start;background:var(--surface);border:1px solid var(--divider)}
    .input-bar{display:flex;align-items:center;padding:.5rem 1rem;border-top:1px solid var(--divider);background:var(--bg)}
    textarea{flex:1;resize:none;border:1px solid var(--divider);border-radius:20px;padding:.6rem 1rem;font-size:.95rem;background:#fff}
    button{background:var(--accent);border:none;border-radius:50%;width:40px;height:40px;margin-left:.5rem;color:#000;font-size:1.2rem;cursor:pointer}
    button:disabled{opacity:.4;cursor:not-allowed}

    /* bottom-sheet (like Pocket Pal) */
    #sheet{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;justify-content:center;align-items:flex-end;z-index:10}
    #sheetContent{width:100%;max-width:600px;background:var(--bg);border-top-left-radius:var(--radius);border-top-right-radius:var(--radius);padding:1rem;animation:slideUp .25s ease-out}
    @keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
    #sheetContent label{font-size:.9rem;font-weight:600;margin-bottom:.25rem;display:block}
    #sheetContent textarea{width:100%;min-height:120px;border:1px solid var(--divider);border-radius:var(--radius);padding:.5rem;font-size:.9rem;resize:vertical}
    #sheetContent .actions{display:flex;justify-content:flex-end;gap:.5rem;margin-top:.75rem}
    #sheetContent .actions button{width:auto;border-radius:var(--radius);padding:.4rem 1rem;font-size:.85rem}
  </style>
</head>

<body>
  <header>Gemini Chat</header>

  <div class="chat-area">
    <div id="messages" style="flex:1;padding:.5rem 0"></div>

    <form class="input-bar" id="chatForm">
      <textarea id="msgInput" placeholder="Ask me anything…" rows="1"></textarea>
      <button id="sendBtn" type="submit" title="Send">➤</button>
      <button id="settingsBtn" type="button" title="System">⚙️</button>
    </form>
  </div>

  <!-- Pocket-Pal-style bottom sheet -->
  <div id="sheet">
    <div id="sheetContent">
      <label>System Instruction</label>
      <textarea id="systemInstruction" placeholder="You are a helpful assistant…"></textarea>

      <label style="margin-top:.75rem">Model</label>
      <select id="modelSelect" style="width:100%;padding:.5rem;border:1px solid var(--divider);border-radius:var(--radius);font-size:.9rem">
        <option value="gemini-2.5-flash">gemini-2.5-flash</option>
        <option value="gemini-2.5-pro">gemini-2.5-pro</option>
      </select>

      <div class="actions">
        <button id="closeSheetBtn" style="background:#e0e0e0;color:#000">Close</button>
      </div>
    </div>
  </div>

<script>
/* --- helpers --- */
const $ = q => document.querySelector(q);
const messagesEl = $('#messages');
const form = $('#chatForm');
const msgInput = $('#msgInput');
const sendBtn = $('#sendBtn');
const settingsBtn = $('#settingsBtn');
const sheet = $('#sheet');
const closeSheetBtn = $('#closeSheetBtn');

/* open / close bottom sheet */
[settingsBtn,closeSheetBtn].forEach(el=>el.onclick=()=>sheet.style.display=sheet.style.display==='flex'?'none':'flex');
/* close on backdrop tap */
sheet.onclick=e=>{if(e.target===sheet)sheet.style.display='none'};

/* chat with Gemini */
form.onsubmit = async e=>{
  e.preventDefault();
  const message = msgInput.value.trim();
  if(!message) return;
  appendBubble(message,'user');
  msgInput.value='';
  sendBtn.disabled=true;

  const payload={
    model:$('#modelSelect').value,
    systemInstruction:$('#systemInstruction').value.trim(),
    message
  };

  try{
    const res = await fetch('https://chatai-flame-eta.vercel.app/api/gemini',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify(payload)
    });
    if(!res.ok) throw new Error(res.statusText);
    const data=await res.json();
    appendBubble(data.text,'bot');
  }catch(err){
    appendBubble('Error: '+err.message,'bot');
  }finally{
    sendBtn.disabled=false;
  }
};

function appendBubble(text,who){
  const div=document.createElement('div');
  div.className='bubble '+who;
  div.textContent=text;
  messagesEl.appendChild(div);
  div.scrollIntoView({behavior:'smooth'});
}
</script>
</body>
</html>
